!function(a){function d(c,d){this.element=c,this.options=a.extend(!0,{},b,d),"placeholder"in this.options&&(this.options.texts.placeholder=this.options.placeholder,delete this.options.placeholder),"default"in this.options.searchOptions&&(this.options.texts.search=this.options.searchOptions.default,delete this.options.searchOptions.default),this.load()}var b={columns:1,search:!1,searchOptions:{showOptGroups:!1,onSearch:function(a){}},texts:{placeholder:"Select options",search:"Search",selectedOptions:" selected",selectAll:"Select all",noneSelected:"None Selected"},selectAll:!1,selectGroup:!1,maxHeight:null,showCheckbox:!0,jqActualOpts:{},optionAttributes:[],onLoad:function(a){},onOptionClick:function(a,b){},onControlClose:function(a){},maxWidth:null,minSelect:!1,maxSelect:!1},c=1;"function"!=typeof Array.prototype.map&&(Array.prototype.map=function(b,c){return"undefined"==typeof c&&(c=this),a.isArray(c)?a.map(c,b):[]}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),d.prototype={load:function(){var b=this;if("SELECT"!=b.element.nodeName||a(b.element).hasClass("jqmsLoaded"))return!0;a(b.element).addClass("jqmsLoaded").data("plugin_multiselect-instance",b),a(b.element).after('<div class="ms-options-wrap"><button>None Selected</button><div class="ms-options"><ul></ul></div></div>');var c=a(b.element).next(".ms-options-wrap").find("> button:first-child"),d=a(b.element).next(".ms-options-wrap").find("> .ms-options"),e=d.find("> ul");!!a(b.element).find("optgroup").length;b.options.showCheckbox||d.addClass("hide-checkbox");var g=null;"number"==typeof b.options.width?(d.parent().css("position","relative"),g=b.options.width):"string"==typeof b.options.width?(a(b.options.width).css("position","relative"),g="100%"):d.parent().css("position","relative");var h=a(window).height()-d.offset().top+a(window).scrollTop()-20;if(b.options.maxHeight&&(h=b.options.maxHeight),h=h<b.options.minHeight?b.options.minHeight:h,d.css({maxWidth:g,minHeight:b.options.minHeight,maxHeight:h,overflow:"auto"}).hide(),d.bind("touchmove mousewheel DOMMouseScroll",function(b){if(a(this).outerHeight()<a(this)[0].scrollHeight){var c=b.originalEvent,d=c.wheelDelta||-c.detail;a(this).outerHeight()+a(this)[0].scrollTop>a(this)[0].scrollHeight&&(b.preventDefault(),this.scrollTop+=d<0?1:-1)}}),a(document).off("click.ms-hideopts").on("click.ms-hideopts",function(b){a(b.target).closest(".ms-options-wrap").length||a(".ms-options-wrap > .ms-options:visible").length&&a(".ms-options-wrap > .ms-options:visible").each(function(){a(this).hide();var b=a(this).parent().prev(".jqmsLoaded").data("plugin_multiselect-instance");"function"==typeof b.options.onControlClose&&b.options.onControlClose(b.element)})}),c.bind("mousedown",function(c){if(1!=c.which)return!0;if(a(".ms-options-wrap > .ms-options:visible").each(function(){a(this).parent().prev()[0]!=d.parent().prev()[0]&&a(this).hide()}),d.toggle(),d.is(":visible")){d.css("maxHeight","");var e=a(window).height()-d.offset().top+a(window).scrollTop()-20;b.options.maxHeight&&(e=b.options.maxHeight),e=e<b.options.minHeight?b.options.minHeight:e,d.css("maxHeight",e)}}).click(function(a){a.preventDefault()}),b.options.texts.placeholder&&c.text(b.options.texts.placeholder),b.options.search){e.before('<div class="ms-search"><input type="text" value="" placeholder="'+b.options.texts.search+'" /></div>');var i=d.find(".ms-search input");i.on("keyup",function(){return a(this).data("lastsearch")==a(this).val()||(a(this).data("lastsearch",a(this).val()),"function"==typeof b.options.searchOptions.onSearch&&b.options.searchOptions.onSearch(b.element),void e.find("li:not(.optgroup)").each(function(){var c=a(this).text();c.toLowerCase().indexOf(i.val().toLowerCase())>-1?a(this).show():a(this).hasClass("selected")||a(this).hide(),!b.options.searchOptions.showOptGroups&&a(this).closest("li.optgroup")&&(a(this).closest("li.optgroup").show(),a(this).closest("li.optgroup").find("li:visible").length?a(this).closest("li.optgroup").show():a(this).closest("li.optgroup").hide())}))})}b.options.selectAll&&e.before('<a href="#" class="ms-selectall global">'+b.options.texts.selectAll+"</a>"),d.on("click",".ms-selectall",function(b){if(b.preventDefault(),a(this).hasClass("global"))e.find("li:not(.optgroup)").filter(":not(.selected)").filter(":visible").length?e.find("li:not(.optgroup)").filter(":not(.selected)").filter(":visible").find('input[type="checkbox"]').trigger("click"):e.find('li:not(.optgroup).selected:visible input[type="checkbox"]').trigger("click");else if(a(this).closest("li").hasClass("optgroup")){var c=a(this).closest("li.optgroup");c.find("li:not(.selected)").filter(":visible").length?c.find('li:not(.selected):visible input[type="checkbox"]').trigger("click"):c.find('li.selected:visible input[type="checkbox"]').trigger("click")}});var j=[];a(b.element).children().each(function(){if("OPTGROUP"==this.nodeName){var c=[];a(this).children("option").each(function(){for(var d={},e=0;e<b.options.optionAttributes.length;e++){var f=b.options.optionAttributes[e];void 0!==a(this).attr(f)&&(d[f]=a(this).attr(f))}c.push({name:a(this).text(),value:a(this).val(),checked:a(this).prop("selected"),attributes:d})}),j.push({label:a(this).attr("label"),options:c})}else{if("OPTION"!=this.nodeName)return!0;for(var d={},e=0;e<b.options.optionAttributes.length;e++){var f=b.options.optionAttributes[e];void 0!==a(this).attr(f)&&(d[f]=a(this).attr(f))}j.push({name:a(this).text(),value:a(this).val(),checked:a(this).prop("selected"),attributes:d})}}),b.loadOptions(j,!0,!1),d.on("click",'input[type="checkbox"]',function(){a(this).closest("li").toggleClass("selected");var c=d.parent().prev();c.find('option[value="'+a(this).val()+'"]').prop("selected",a(this).is(":checked")).closest("select").trigger("change"),"function"==typeof b.options.onOptionClick&&b.options.onOptionClick(b.element,this),b._updatePlaceholderText()}),d.on("focusin",'input[type="checkbox"]',function(){a(this).closest("label").addClass("focused")}).on("focusout",'input[type="checkbox"]',function(){a(this).closest("label").removeClass("focused")}),"function"==typeof b.options.onLoad&&b.options.onLoad(b.element),a(b.element).hide()},loadOptions:function(b,c,d){c="boolean"!=typeof c||c,d="boolean"!=typeof d||d;var e=this,f=a(e.element).next(".ms-options-wrap").find("> .ms-options > ul"),g=a(e.element).next(".ms-options-wrap").find("> .ms-options"),h=g.parent().prev();c&&(f.find("> li").remove(),d&&h.find("> *").remove());for(var i in b)if(b.hasOwnProperty(i)){var j=b[i],k=a("<li></li>"),l=!0;if(j.hasOwnProperty("options")){if(f.find("> li.optgroup > span.label").each(function(){a(this).text()==j.label&&(k=a(this).closest(".optgroup"),l=!1)}),d)if(h.find('optgroup[label="'+j.label+'"]').length)var m=h.find('optgroup[label="'+j.label+'"]');else{var m=a('<optgroup label="'+j.label+'"></optgroup>');h.append(m)}l&&(k.addClass("optgroup"),k.append('<span class="label">'+j.label+"</span>"),k.find("> .label").css({clear:"both"}),e.options.selectGroup&&k.append('<a href="#" class="ms-selectall">'+e.options.texts.selectAll+"</a>"),k.append("<ul></ul>"));for(var n in j.options)if(j.options.hasOwnProperty(n)){var o=j.options[n],p=a("<li></li>").addClass("ms-reflow");if(e._addOption(p,o),k.find("> ul").append(p),d){var q=a('<option value="'+o.value+'">'+o.name+"</option>");o.hasOwnProperty("attributes")&&Object.keys(o.attributes).length,o.checked&&q.prop("selected",!0),m.append(q)}}}else if(j.hasOwnProperty("value")&&(k.addClass("ms-reflow"),e._addOption(k,j),d)){var q=a('<option value="'+j.value+'">'+j.name+"</option>");j.hasOwnProperty("attributes")&&Object.keys(j.attributes).length&&q.attr(j.attributes),j.checked&&q.prop("selected",!0),h.append(q)}l&&f.append(k)}f.find('.ms-reflow input[type="checkbox"]').each(function(b){if(a(this).css("display").match(/block$/)){var c=a(this).outerWidth();c=c?c:15,a(this).closest("label").css("padding-left",2*parseInt(a(this).closest("label").css("padding-left"))+c),a(this).closest(".ms-reflow").removeClass("ms-reflow")}}),e._updatePlaceholderText(),g.find("ul").css({"column-count":"","column-gap":"","-webkit-column-count":"","-webkit-column-gap":"","-moz-column-count":"","-moz-column-gap":""}),h.find("optgroup").length?(f.find("> li:not(.optgroup)").css({float:"left",width:100/e.options.columns+"%"}),f.find("li.optgroup").css({clear:"both"}).find("> ul").css({"column-count":e.options.columns,"column-gap":0,"-webkit-column-count":e.options.columns,"-webkit-column-gap":0,"-moz-column-count":e.options.columns,"-moz-column-gap":0}),this._ieVersion()&&this._ieVersion()<10&&f.find("li.optgroup > ul > li").css({float:"left",width:100/e.options.columns+"%"})):(f.css({"column-count":e.options.columns,"column-gap":0,"-webkit-column-count":e.options.columns,"-webkit-column-gap":0,"-moz-column-count":e.options.columns,"-moz-column-gap":0}),this._ieVersion()&&this._ieVersion()<10&&f.find("> li").css({float:"left",width:100/e.options.columns+"%"}))},unload:function(){a(this.element).next(".ms-options-wrap").remove(),a(this.element).show(function(){a(this).css("display","").removeClass("jqmsLoaded")})},reload:function(){a(this.element).next(".ms-options-wrap").remove(),a(this.element).removeClass("jqmsLoaded"),this.load()},_updatePlaceholderText:function(){var b=this,c=a(b.element).next(".ms-options-wrap").find("> button:first-child"),d=a(b.element).next(".ms-options-wrap").find("> .ms-options"),e=d.parent().prev(),f=[];e.find("option:selected").each(function(){f.push(a(this).text())}),c.text(f.join(", "));var g=c.clone().css({display:"inline",width:"auto",visibility:"hidden"}).appendTo(d.parent()),h="undefined"!=typeof a.fn.actual?g.actual("width",b.options.jqActualOpts):g.width(),i="undefined"!=typeof a.fn.actual?c.actual("width",b.options.jqActualOpts):c.width();h>i?c.text(f.length+b.options.texts.selectedOptions):f.length?c.text(f.map(function(a){return a.trim()}).join(", ")):c.text(b.options.texts.placeholder),g.remove()},_addOption:function(b,d){b.text(d.name);var e=a('<input type="checkbox" value="" title="" />').val(d.value).attr("title",d.name).attr("id","ms-opt-"+c);d.hasOwnProperty("attributes")&&Object.keys(d.attributes).length&&e.attr(d.attributes),b.prepend(e),d.checked&&(b.addClass("default"),b.addClass("selected"),b.find('input[type="checkbox"]').prop("checked",!0));var f=a("<label></label>").attr("for","ms-opt-"+c);b.wrapInner(f),c+=1},_ieVersion:function(){var a=navigator.userAgent.toLowerCase();return a.indexOf("msie")!=-1&&parseInt(a.split("msie")[1])}},a.fn.multiselect=function(b){var e,c=arguments;return void 0===b||"object"==typeof b?this.each(function(){a.data(this,"plugin_multiselect")||a.data(this,"plugin_multiselect",new d(this,b))}):"string"==typeof b&&"_"!==b[0]&&"init"!==b?(this.each(function(){var f=a.data(this,"plugin_multiselect");f instanceof d&&"function"==typeof f[b]&&(e=f[b].apply(f,Array.prototype.slice.call(c,1))),"unload"===b&&a.data(this,"plugin_multiselect",null)}),e):void 0}}(jQuery);